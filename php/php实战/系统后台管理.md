# PHP 留言板系统后台管理

## 后台管理功能分析

admin.php 用于留言板系统的后台管理，其逻辑基本与 index.php 相同，分页输出各条留言，只是增加了：

  1. 登录检测：在此页面开始部分增加管理用户登录判断，如果是未登录而直接访问该页面，则重定向至登录页面login.php
  2. 删除等管理功能：每条提供一个删除链接

## 后台管理主页面 admin.php

### 登录检测

在需要权限才能操作的界面都应该先进行用户登录检测，复杂的情况下还要进行权限检测。本留言板例子需要进行登录检测的有 admin.php 和 reply.php
这两个页面。

登录检测代码如下：

```php
<?php
session_start();
if(!isset($_SESSION['username'])){
	header("location:http://127.0.0.1/guest2/login.php");
	exit();
}
// 检测是否登录
?>
```
    

### 留言列表管理功能

留言管理界面需要加入的管理功能为与留言删除链接，这里大部分代码与
[index.php](http://www.5idev.com/p-php_guestbook_index.shtml)
页面一致，因此部分重复代码会省略：
```
<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">   
    <title>后台管理</title>
</head>
<body>
<h3>欢迎回来主人</h3> <a href="action.php?action=exit">退出</a>
<table border="1">
<?php
require("./conn.php");
$sql = "SELECT * FROM guestbook";
$result = @mysql_query($sql);
if(!$result){exit("数据库查询错误");}
//  查询用户留言信息
 
while($arr =mysql_fetch_array($result)){
 	echo '<tr>';
 		echo '<td>',$arr['nickname'],'</td>';	
 		echo '<td>',$arr['content'],'</td>';
 		echo '<td><a href="./action.php?action=delete&id=',$arr['id'],'">删除</a></td>';	 
 	echo '</tr>';
}
// 显示用户留言信息
?>
</table>

<body>
</html>
```


    
