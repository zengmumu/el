 
# 留言版源码
[index.php](php实战/信息读取展示.md)：留言板主界面，用于留言读取显示及用户留言表单（留言表单在留言显示下方）
```
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
<h1>留言版本</h1>
<form action="submiting.php" method="POST">
用户名	<input type="text" name="nickname"/><br>
邮箱  <input type="text" name="email"><br>
留言	 <textarea name="content" id="" cols="30" rows="10"></textarea>
<input type="submit" value="提交留言">

</form>

<?php
//  数据库连接
require("./conn.php");
// 分页处理
$pagesize=3;
$q=isset($_GET["p"])?$_GET["p"]:1;
$offset = $q*$pagesize;
$sql = "SELECT * FROM guestbook ORDER BY id DESC LIMIT $offset, $pagesize";
//$sql = "SELECT * FROM guestbook ORDER BY id DESC LIMIT 3 ";

//  查询显示数据
$result = @mysql_query($sql);
if(!$result) exit("查询数据库错误");
while($arr = mysql_fetch_array($result)){
	echo  $arr['nickname'],'发表于 ';
	echo date('Y-m-d H:i',$arr['createtime']),'<br>';
	echo '内容',$arr['content'],'<br><hr>';
}

// 分页功能
$count_result = mysql_query("SELECT COUNT(*) as pages FROM guestbook");
$count_array = mysql_fetch_array($count_result);
$page_num = ceil($count_array['pages']/$pagesize);
// 显示分类
for($i=1;$i<$page_num;$i++){
	echo "&nbsp;<a href='index.php?p=$i'>$i</a>";
}
?>
<body>
</html>

```
## conn.php
[conn.php](php实战/信息读取展示.md)：数据库连接包含文件
```
<?php
$conn = @mysql_connect("localhost","root","root");
if(!$conn){
	die("数据库连接错误");
}
mysql_select_db("guest",$conn);
?>
```
## submiting.php
* [submiting.php](php实战/表单及留言处理.md)：处理留言者提交的留言信息
```
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Document</title>
</head>
<body>
<?php
	require("./conn.php");
	// 获取页面数据
	$nickname = $_POST["nickname"];
	$email = $_POST["email"];
	$content = $_POST["content"];
	$createtime=time();
	
    // 执行插入结果
	$sql = "INSERT INTO guestbook(nickname,email,content,createtime)VALUES ('$nickname','$email','$content',$createtime)";
	if(mysql_query($sql)){
		exit('<script>alert("添加成功");window.location="index.php";</script>');
	}else{
		exit('<script>alert("添加失败");window.history.back();</script>');
	}
?>
<body>
</html>
```
## login.php
 [login.php](php实战/后台管理登陆.md)：管理员登录及验证页面 

```
<?php
session_start();
//  开启session
require("./conn.php");
if($_POST){
	$username = $_POST["username"];
	$password = md5($_POST["password"]);
	$sql = "SELECT uid FROM user where username='$username' AND password='$password'";
	$result = mysql_query($sql);
	//  查询用户
	
	if(mysql_fetch_array($result)){
		$_SESSION["username"] = 1;
		// 设置session 并跳转
		header("Location:http://127.0.0.1/guest2/admin.php");
	}else{
		echo '用户名或密码错误';
	}
}
?>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
 <h3>登录</h3>
 <form action="./login.php" method="POST">
 用户名: <input type="text" name="username"><br>
 密码：<input name="password" type="password"><br>
 <input type="submit" value="登录">
</form>
<body>
</html>

```

## admin.php
 [admin.php](php实战/系统后台管理.md)：留言管理主界面，读取留言数据，提供删除等操作界面
```
<?php
session_start();
if(!isset($_SESSION['username'])){
	header("location:http://127.0.0.1/guest2/login.php");
	exit();
}
// 检测是否登录
?>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
<h3>欢迎回来主人   </h3>
<a href="action.php?action=exit">退出</a>
<table border="1">
<?php
require("./conn.php");
// 分页处理
$pagesize=3;
$q=isset($_GET["p"])?$_GET["p"]:1;
$offset = $q*$pagesize;
$sql = "SELECT * FROM guestbook ORDER BY id DESC LIMIT $offset, $pagesize";
// $sql = "SELECT * FROM guestbook LIMIT 3";
$result = @mysql_query($sql);
if(!$result){exit("数据库查询错误");}
//  查询用户留言信息
 
while($arr =mysql_fetch_array($result)){
 	echo '<tr>';
 		echo '<td>',$arr['nickname'],'</td>';	
 		echo '<td>',$arr['content'],'</td>';
 		echo '<td><a href="./action.php?action=delete&id=',$arr['id'],'">删除</a></td>';	 
 	echo '</tr>';
}
// 显示用户留言信息
// 分页功能
$count_result = mysql_query("SELECT COUNT(*) as pages FROM guestbook");
$count_array = mysql_fetch_array($count_result);
$page_num = ceil($count_array['pages']/$pagesize);
// 显示分类
for($i=1;$i<$page_num;$i++){
	echo "&nbsp;<a href='index.php?p=$i'>$i</a>";
}
?>
</table>

<body>
</html>
```

## action.php
 [action.php](php实战/删除留言与退出.md) 处理用户的退出与删除留言功能
## index.php
```
<?php
session_start();
if(!isset($_SESSION['username'])){
	header("location:http://127.0.0.1/guest2/login.php");
	exit();
}
?>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Document</title>
</head>
<body>
<?php
require('./conn.php');
//如果动作是删除则执行删除操作
if($_GET['action']=='delete'){
	$sql = 'DELETE FROM guestbook WHERE id='.$_GET["id"];
	if(mysql_query($sql)){
		exit('<script>alert("删除成功");window.location="admin.php";</script>');
	}else{
		exit('<script>alert("删除失败");window.history.back();</script>');
	}
}
if($_GET['action']=='exit'){
	 //彻底销毁 Session
     session_destroy();
     exit('<script>alert("成功退出");window.location="login.php";</script>');
}
?>
<body>
</html>
```