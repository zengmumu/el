# MySQL 表字段属性

## 主键

表的主键（primary
key，主关键字）是表中的一个或多个字段，它的值用于惟一地标识表中的某一条记录。一个表不能有多个主关键字，并且主关键字的列不能包含空值和重复值。主关键字是可选的，并且可在
CREATE TABLE 或 ALTER TABLE 语句中定义。

语法：

    
    
    PRIMARY KEY (column_name)
    

uid | username | password | email | regdate  
---|---|---|---|---  
1 | admin | b7e591c246d010bb2ccd77d52490c85e | admin@5idev.com | 1277992339  
2 | 小明 | a193686a53e4de85ee3f2ff0576adf01 | xiao@163.com | 1278063917  
3 | Jack | 0193686a35e4de85ee3f2ff0567adf490 | jack@gmail.com | 1278061380  
  
在这个表中，uid 这个字段就是该表的主键。

### 建立主键应该遵循的一般原则

  1. 主键应当是对用户没有意义的
  2. 永远也不要更新主键，如果主键需要更新，则说明主键应对用户无意义的原则被违反了
  3. 主键不应包含动态变化的数据，如时间戳、创建时间等
  4. 主键应当由系统自动生成

## 外键

在两个表的关系中，当一张表（如表A ）的主关键字被包含在另一张表（如表B）中时，A 表中的主关键字便成为 B 表的外键（外关键字）。B 表称为主表，A
表称为从表。

外键主要用于保持数据一致性，完整性，避免冗余数据，使两张或多张表形成关联。

cid | uid | comment | createtime | clientip  
---|---|---|---|---  
1 | 1 | 评论测试。。 | 1278011380 | 123.123.123.123  
2 | 1 | 写得很详细呀，谢谢! | 1278063917 | 123.123.123.123  
3 | 3 | 学习了！ | 1278069380 | 123.123.123.123  
  
在这个文章评论表 comment 样例中，uid 便是外键，它是 user 表的主键。在该表中记录了用户对文章的评论，关于用户信息，只需对应 user
表的主键 uid 即可。在数据一致性方面，比如当 comment 表没有 uid 为 3 的评论后，才可以删除 user 表中 uid = 3 的记录。

## 自动递增

在 MySQL 数据库中，提供了字段的自动递增（AUTO_INCREMENT）属性，即将该字段设置为 int
类的数据类型，每向数据表添加一条记录，该字段的值会自动加1 。设置了自动递增后，该列不用再设置默认值和唯一性约束。

例子：

    
    
    uid mediumint(8) NOT NULL auto_increment
    

## 非空

因为逻辑上的一些要求，有时候需要把字段属性设置为非空（NOT NULL），如记录用户名、密码等非空值的字段。

设置为非空的列，虽然不是必须，但最好设定一个默认值，以防止意外的错误和减少增加数据时的 SQL
语句复杂度。当向数据表增加数据记录时，如果设置为非空的字段不写入数据，系统将会以默认值写入。

例子：

    
    
    username char(20) NOT NULL default ''
    //将NOT NULL 改为 NULL
    ALTER TABLE user CHANGE username username char(20) NULL
    

### 提示

在上面的例子中 CHANGE 后面 username username ，前者表示更改的字段名，后者表示新字段名。在本例中，只更改了字段属性为 NULL
，不涉及到字段名称的更改，因此二者一致。

## 空

与非空相反，可以将字段属性设置为空，如果字段属性没有设置为非空（NOT NULL）属性，那么系统默认就是可以为空（NULL）值的。

将NULL 改为 NOT NULL：

    
    
    ALTER TABLE user CHANGE username username char(20) NOT NULL DEFAULT ''
    

## 唯一性约束

有时候某些字段数据不允许重复，如用户名，这时候就需要增加唯一性约束（UNIQUE）。

语法：

    
    
    UNIQUE (column_name)
    //给表字段增加 UNIQUE
    ALTER TABLE tb_name ADD UNIQUE (column_name)
    //去掉 UNIQUE
    ALTER TABLE tb_name DROP INDEX column_name
    

主键（PRIMARY KEY）会强制性的拥有自动定义的唯一性约束，不用额外定义 UNIQUE 。

## 索引

数据库索引（index）是为了增加查询速度而对字段附加的一种标识。我们对表的某些可能需要经常查询的字段建立适当的索引，那么在查询该字段数据时，便会显著的加快查询速度。

语法：

    
    
    KEY key_name (column_name)
    

KEY 后面的字符为索引名称，括号内为建立索引的字段名。

## 改进后的建表 SQL

    
    
    CREATE TABLE user (
        uid mediumint(8) unsigned NOT NULL auto_increment,
        username char(15) NOT NULL default '',
        password char(32) NOT NULL default '',
        email varchar(40) NOT NULL default '',
        regdate int(10) unsigned NOT NULL default '0',
        PRIMARY KEY (uid),
        UNIQUE KEY username (username),
        KEY email (email)
    ) ENGINE=MyISAM  DEFAULT CHARSET=utf8 AUTO_INCREMENT=1 ;
    

### 补充说明

在建表语句正文后面还附加了建表的其它几个属性：

  1. ENGINE：表示存储引擎类型，分为 MyISAM 和 InnoDB 两种类型。MyISAM 不支持事务处理等高级处理，强调表的性能，执行也比 InnoDB 快。而 InnoDB 提供事务支持已经外部键等高级数据库功能，性能上比 MyISAM 差。默认为 MyISAM 类型
  2. CHARSET：表示数据表表字符集，一般为 gbk 或 utf8 以及 big5 等，为了兼容性考虑，我们设置为 utf8 字符集
  3. AUTO_INCREMENT：设置主键默认增长的开始数
